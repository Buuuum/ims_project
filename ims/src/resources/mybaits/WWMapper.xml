<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ims.sunmoon.persistence.WWMapper">
	<resultMap id="wwResultMap" type="ww">
		<id column="WW_NO" property="wwNo" />
		<result column="WARE_NO" property="wareNo" />
		<result column="WITH_NO" property="withNo" />
		<result column="WW_DATE" property="wwDate" />
		<result column="QUANTITY" property="quantity" />
		<result column="AMMOUNT" property="ammount" />
		<result column="USEABLE" property="useable" />
		<result column="CON_VER" property="conVer" />
		<result column="NOTE" property="note" />
	</resultMap>
	
	<select id="list" parameterType="ww" resultMap="wwResultMap">
		SELECT WW_NO
			  ,WARE_NO
			  ,WITH_NO
			  ,WW_DATE
			  ,QUANTITY
			  ,AMMOUNT
			  ,CON_VER
			  ,NOTE
		FROM WW
		<where>
			<if test="wwNo > 0">
				AND WW_NO = #{wwNo}
			</if>
			<if test="wareNo > 0">
				AND WARE_NO = #{wareNo}
			</if>
			<if test="withNo > 0">
				AND WITH_NO = #{withNo}
			</if>
			<if test="wwDate != null and wwDate != ''">
				AND WW_DATE = #{wwDate}
			</if>
			<if test="first != null and last != null">
				AND WW_DATE BETWEEN #{first}
				AND #{last} + 1
			</if>
			AND USEABLE = #{useable}
		</where>
		<if test="wwSortOption != null">
			<if test="wwSortOption.name() == 'NO'">
				ORDER BY WW_NO ASC
			</if>
			<if test="wwSortOption.name() == 'WARE_NO'">
				ORDER BY WARE_NO ASC
			</if>
			<if test="wwSortOption.name() == 'WITH_NO'">
				ORDER BY WITH_NO ASC
			</if>
			<if test="wwSortOption.name() == 'WW_DATE'">
				ORDER BY WW_DATE DESC
			</if>
			<if test="wwSortOption.name() == 'QUANTITY'">
				ORDER BY QUANTITY DESC
			</if>
			<if test="wwSortOption.name() == 'AMMOUNT'">
				ORDER BY AMMOUNT DESC
			</if>
		</if>
	</select>
	
	<select id="select" parameterType="bd" resultMap="bdResultMap">
		SELECT WW_NO
			  ,WARE_NO
			  ,WITH_NO
			  ,WW_DATE
			  ,QUANTITY
			  ,AMMOUNT
			  ,CON_VER
			  ,NOTE
		FROM WW
		WHERE WW_NO = #{wwNo}
		AND USEABLE = #{useable}
	</select>

	<insert id="insert" parameterType="bd">
		<selectKey keyColumn="WW_NO" keyProperty="wwNo" resultType="int" order="BEFORE">
			SELECT WW_SEQ.NEXTVAL
			FROM DUAL
		</selectKey>
		INSERT INTO WW
			( WW_NO
			  ,WARE_NO
			  ,WITH_NO
			  ,WW_DATE
			  ,QUANTITY
			  ,AMMOUNT
			  ,CON_VER
			  ,NOTE
			  ,USEABLE )
		VALUES
			(#{wwNo}, #{wareNo}, #{withNo}, SYSDATE, #{quantity}, 
			 #{ammount}, #{conVer}, #{note}, 1)
	</insert>

	<update id="update" parameterType="bd">
		UPDATE 
		WW
		SET
		WARE_NO    = #{wareNo},
		WITH_NO   = #{withNo},
		WW_DATE  = #{wwDate},
		QUANTITY = #{quantity},
		AMMOUNT  = #{ammount},
		CON_VER  = #{conVer},
		USEABLE  = #{useable},
		NOTE     = #{note}
		WHERE
		WW_NO    = #{wwNo}
	</update>

	<update id="delete" parameterType="bd">
		UPDATE
		WW
		SET
		USEABLE = 0
		WHERE
		WW_NO = #{wwNo}
	</update>
</mapper>